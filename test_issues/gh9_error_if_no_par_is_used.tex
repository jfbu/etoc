\DocumentMetadata{
 uncompress,
 pdfversion=1.7,
 lang=en-US,
 testphase=phase-III
}
\ExplSyntaxOn
 \msg_redirect_module:nnn { tag } { warning } { error }
\ExplSyntaxOff
\documentclass{article}
\usepackage[T1]{fontenc}
\usepackage{etoc}
\begin{document}
\etocsetstyle{section}
  {(start) }
  {\etocname, }
  {}
  {(end) }%

\tableofcontents

\etocinline
\etocsettocstyle{}{}

\bigskip
inline toc \tableofcontents with text directly after it.

\bigskip

inline toc with no text directly after it \tableofcontents

\bigskip

\tableofcontents is a toc with inline line styles, which however got started
in vmode; when the contents start in vmode, etoc adds a \verb|\par| after
contents to avoid the present issue. (TODO: try to lift that)

\bigskip

\leavevmode
\tableofcontents is an inline toc at very start of a paragraph, which got
prefixed by user mark-up \verb|\leavevmode| so this way etoc did not end its
contents with a \verb|\par|.


\bigskip


\def\etocaftercontentshook{These }

\texttt{meaning of \string\etocaftercontentshook is \meaning\etocaftercontentshook}

\tableofcontents contents again got started in vmode, and etoc added
forcefully a \verb|\par| after contents (but \emph{before}
\verb|\etocaftercontentshook|) to avoid the present issue.

\bigskip

\section{One}

Text

\section{Two}

Text

\end{document}
